<!-- Header -->
{% assign header_images = site.static_files | where_exp: "f", "f.path contains '/assets/img/header-carousel/'" | sort: 'path' %}
{% if site.locale and site.locale != "" and site.locale != nil %}
<header class="masthead" id="home">
  {% if header_images.size > 0 %}
  <div class="masthead-bg a" style="background-image: url('{{ header_images[0].path | relative_url }}');"></div>
  <div class="masthead-bg b"></div>
  <div class="masthead-overlay"></div>
  {% endif %}
  <div class="container">
    <div class="intro-text">
      {%- if site.data.sitetext[site.locale].header.text -%}
        <div class="intro-heading text-uppercase">{{ site.data.sitetext[site.locale].header.text | markdownify }}</div>
      {%- endif -%}
      {%- if site.data.sitetext[site.locale].header.title -%}
        <div class="intro-lead-in">{{ site.data.sitetext[site.locale].header.title | markdownify }}</div>
      {%- endif -%}
    </div>
  </div>
</header>
{% else %}
<header class="masthead">
  {% if header_images.size > 0 %}
  <div class="masthead-bg a" style="background-image: url('{{ header_images[0].path | relative_url }}');"></div>
  <div class="masthead-bg b"></div>
  <div class="masthead-overlay"></div>
  {% endif %}
  <div class="container">
    <div class="intro-text">
      {%- if site.data.sitetext.header.title -%}
        <div class="intro-lead-in">{{ site.data.sitetext.header.title | markdownify }}</div>
      {%- endif -%}
      {%- if site.data.sitetext.header.text -%}
        <div class="intro-heading text-uppercase">{{ site.data.sitetext.header.text | markdownify }}</div>
      {%- endif -%}
      {%- if site.data.sitetext.header.button -%}
        <a class="btn btn-primary btn-xl text-uppercase js-scroll-trigger" href="{{ site.data.sitetext.header.buttonlink }}">{{ site.data.sitetext.header.button }}</a>
      {%- endif -%}
    </div>
  </div>
</header>
{% endif %}
<!-- End Header -->

{% comment %} Focus Area Cards (below header) {% endcomment %}
{% if site.locale and site.locale != "" and site.locale != nil %}
  {% assign headerdata = site.data.sitetext[site.locale].header %}
{% else %}
  {% assign headerdata = site.data.sitetext.header %}
{% endif %}

{% if headerdata.fields and headerdata.fields.size > 0 %}
<section class="page-section bg-light" id="{{ headerdata.fields_section | default: 'focus' }}">
  <div class="container">
    <div class="text-center">
      {% if headerdata.fields_title %}<h2 class="section-heading text-uppercase">{{ headerdata.fields_title | markdownify }}</h2>{% endif %}
      {% if headerdata.fields_text %}<h3 class="section-subheading text-muted">{{ headerdata.fields_text | markdownify }}</h3>{% endif %}
    </div>

    <div class="row">
      {% for f in headerdata.fields %}
      <div class="col-12 col-md-6 col-lg-4 mb-4">
        <div class="card h-100 border-0 shadow-sm">
          {% if f.image %}
          <img class="card-img-top focus-card-img" src="{{ f.image | relative_url }}" alt="{{ f.alt | default: f.title }}">
          {% endif %}
          <div class="card-body">
            {% if f.title %}<h5 class="card-title mb-2">{{ f.title | markdownify }}</h5>{% endif %}
            {% if f.desc %}<p class="card-text text-muted mb-0">{{ f.desc | markdownify }}</p>{% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{% comment %} Header background image carousel (every 2s) {% endcomment %}
{% if header_images and header_images.size > 1 %}
<script>
  (function() {
    var header = document.querySelector('header.masthead');
    if (!header) return;
    var bgA = header.querySelector('.masthead-bg.a');
    var bgB = header.querySelector('.masthead-bg.b');
    if (!bgA || !bgB) return;
    var imgs = [
      {% for f in header_images %}'{{ f.path | relative_url }}'{% unless forloop.last %}, {% endunless %}{% endfor %}
    ];
    var i = 0;
    bgA.classList.add('visible');
    setInterval(function() {
      i = (i + 1) % imgs.length;
      var show = bgB, hide = bgA;
      if (bgB.classList.contains('visible')) {
        show = bgA; hide = bgB;
      }
      show.style.backgroundImage = 'url(' + imgs[i] + ')';
      show.classList.add('visible');
      hide.classList.remove('visible');
      // swap refs
      var tmp = bgA; bgA = bgB; bgB = tmp;
    }, 5000);
  })();
  </script>
{% endif %}
